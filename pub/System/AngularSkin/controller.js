(function(){"use strict";var e=angular.module("foswikiController",[]);e.controller("ViewCtrl",["$scope","$window","$timeout","$sce","$log","$location","foswikiService","foswikiAppSettings",function(e,r,i,o,t,c,n,a){var f=new RegExp("^/(?:(view|login)/)?((?:[^/]+/)+)([^/]+)/?$"),s="",l="",u="";function p(){var r,i=c.path(),o=c.absUrl().replace(/#.*/,""),n=c.search(),p=n.angular,d,w;r=f.exec(i);if(r){e.script=r[1]||"view";d=r[2]||a.defaultWebName;w=r[3]||a.homeTopicName}else{e.script="view";d=a.defaultWebName;w=a.homeTopicName}d=d.replace(/^\/|\/$/g,"");w=w.replace(/^\/|\/$/g,"");foswiki.preferences.WEB=d;foswiki.preferences.TOPIC=w;t.debug("parse path=",i,"script=",e.script,"web=",d,"topic=",w);if(typeof p!=="undefined"&&p==="0"){var o=foswiki.getPreference("SCRIPTURL")+"/view/"+d+"/"+w+"?angular=0";t.debug("redirecting to ",o);window.location.href=o;return}if(d!==s||w!==l){e.web=s=d;e.topic=l=w;u=o;return true}else{if(o!==u){u=o;e.forceReload=(new Date).getTime()}}return false}function d(){i(function(){n.render(e).then(function(i){r.scrollTo(0,0);e.$broadcast("foswiki.pageLoaded")},function(r){if(r){var i="ERROR "+r.error.code+": "+r.error.message;t.error(i);if(r.error.code===401&&e.script!=="login"){c.path("/login/"+e.web+"/"+e.topic).replace()}}else{t.debug("aborded previous request")}})})}e.$on("$locationChangeSuccess",function(){if(p()){d()}});e.$watch("forceReload",function(){if(e.forceReload){d()}})}])})();